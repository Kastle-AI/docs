# Kastle AI - Payment Collections Agent API Documentation

## Overview

This documentation outlines the API integration for Kastle AI's payment collections agent. The system processes borrower entities and makes automated outbound calls based on the data you provide. This API can be customized for your organization's specific collections workflow and requirements.

There are two types of APIs that will be made available:
- **Test API Endpoints**: For testing and development with a pre-configured campaign
- **Production Entity Management APIs**: For production campaigns with your own campaign IDs

## Data Requirements

The following is a comprehensive list of data fields that can be configured for your payment collections agent. Fields can be customized based on your organization's requirements:

### Core Customer Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| FirstName               | Customer first name                                                               | String    |
| LastName                | Customer last name                                                                | String    |
| DOB                     | Customer's date of birth, in YYYY-MM-DD format                                     | String    |
| TaxIDLastFour           | Last four digits of customer's social security number                             | Number    |
| AccountID               | The unique identifier for the customer's account, used for lookup and verification | String    |
| PhoneNumber             | Customer's phone number                                                           | String    |
| Email                   | Customer's email address                                                          | String    |
| PreferredLanguage       | Code indicating the customer's preferred language (e.g., en=English, es=Spanish)  | String    |

### Address Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| PrimaryAddress          | Customer's primary address - street address                                       | String    |
| PrimaryCity             | Customer's primary address - city                                                 | String    |
| PrimaryState            | Customer's primary address - state                                                | String    |
| PrimaryZip              | Customer's primary address - ZIP code                                             | String    |
| MailingAddress          | Customer's mailing address - street address                                       | String    |
| MailingCity             | Customer's mailing address - city                                                 | String    |
| MailingState            | Customer's mailing address - state                                                | String    |
| MailingZip              | Customer's mailing address - ZIP code                                             | String    |

### Account Financial Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| RegularPaymentAmount    | The regular payment amount due                                                    | Number    |
| TotalAmountDue          | The total amount currently due including all charges and fees                     | Number    |
| LateChargesBalance      | The amount of any late fees currently assessed on the account                     | Number    |
| AccountBalance          | The current total balance of the account                                          | Number    |
| PendingPayment          | Boolean indicator of whether there's a payment currently being processed          | Boolean   |
| HasAutomaticPayments    | Boolean indicator of whether the customer is enrolled in automatic payments       | Boolean   |
| DaysLate                | The number of days the account is past due, if applicable                         | Number    |
| NextPaymentDueDate      | The date when the customer's next payment is due, in YYYY-MM-DD format            | String    |
| LastPaymentDate         | The date when the most recent payment was received, in YYYY-MM-DD format          | String    |
| LastPaymentAmount       | The amount of the last payment received                                           | Number    |

### Payment Methods

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| PaymentMethods          | An array of available payment methods with AccountId and AccountNumberLastFour    | Array[JSON] |

### Account Status Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| AccountStatus           | The current status of the account (e.g., CURRENT, DELINQUENT, COLLECTIONS)        | String    |
| LastContactDate         | The date when the customer was last contacted                                     | String    |
| CustomerFlags           | Any special handling flags (e.g., DO_NOT_CALL, DECEASED, VIP)                    | Array[String] |
| PaymentHistory          | A brief summary of recent transaction activity                                    | String    |

### Additional Customer Information (Optional)

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| SecondaryContactName    | Name of secondary contact or co-borrower (if any)                                | String    |
| SecondaryContactPhone   | Phone number of secondary contact (if any)                                        | String    |
| SecondaryContactDOB     | Date of birth of secondary contact (if any)                                       | String    |
| CustomField1            | Organization-specific custom field                                                | String    |
| CustomField2            | Organization-specific custom field                                                | String    |
| CustomField3            | Organization-specific custom field                                                | String    |

### Example Data

See below for an example JSON schema of the datapoints above, with example data.

```json
{
  "FirstName": "John",
  "LastName": "Smith",
  "DOB": "1973-06-15",
  "TaxIDLastFour": 6394,
  "AccountID": "ACC-1234567",
  "PhoneNumber": "+19876543210",
  "Email": "john.smith@example.com",
  "PreferredLanguage": "en",
  "PrimaryAddress": "123 Main Street",
  "PrimaryCity": "San Francisco",
  "PrimaryState": "California",
  "PrimaryZip": "94103",
  "MailingAddress": "123 Main Street",
  "MailingCity": "San Francisco",
  "MailingState": "California",
  "MailingZip": "94103",
  "RegularPaymentAmount": 1250,
  "TotalAmountDue": 1500,
  "LateChargesBalance": 250,
  "AccountBalance": 45000,
  "PendingPayment": false,
  "HasAutomaticPayments": false,
  "DaysLate": 10,
  "NextPaymentDueDate": "2025-09-28",
  "LastPaymentDate": "2025-08-28",
  "LastPaymentAmount": 1250,
  "PaymentMethods": [
    {
      "AccountId": "57bfcd39-cf7a-42e9-8934-ccfd95669868",
      "AccountNumberLastFour": "1234"
    },
    {
      "AccountId": "b8d0cb94-a46c-4ddf-9b31-e21415a7b3ba",
      "AccountNumberLastFour": "5678"
    }
  ],
  "AccountStatus": "DELINQUENT",
  "LastContactDate": "2025-08-15",
  "CustomerFlags": [],
  "PaymentHistory": "Paid 2025-08-28: $1250.00 | Paid 2025-07-28: $1245.12 | Paid 2025-06-29: $1275.89",
  "SecondaryContactName": "Jane Smith",
  "SecondaryContactPhone": "+19876543211",
  "SecondaryContactDOB": "1975-06-16"
}
```

## API Endpoints

Test and production API endpoints will be configured based on your organization's requirements and infrastructure.

### 1. Trigger Call Endpoint

**Endpoint:** `/collections/{organization}/{environment}/trigger-call`  
**Method:** POST  
**Content-Type:** application/json  
**Authentication:** Bearer token or API key required

Note: This endpoint triggers an automated collection call to the specified customer. Authentication is required with valid organization credentials. The environment may be `test`, `staging`, or `prod`.

#### Request Body

The request body should include the customer data fields configured for your organization. See the Data Requirements section above for available fields.

```json
{
  "FirstName": "string",
  "LastName": "string",
  "AccountID": "string",
  "PhoneNumber": "string",
  // ... additional fields based on your configuration
}
```

#### Response

**Success Response (200 OK):**
```json
{
  "message": "Campaign entity created successfully",
  "entity_id": "string",
  "call_scheduled_for": "YYYY-MM-DDTHH:MM:SSZ",
  "data": {
    // Returns the submitted data with generated entity_id
  }
}
```

**Error Response (400 Bad Request):**
```json
{
  "status": "error",
  "error": "Invalid request data",
  "details": "string"
}
```

**Error Response (401 Unauthorized):**
```json
{
  "status": "error",
  "error": "Invalid or missing authentication token"
}
```

### 2. Process Payment API

During a collection call, the agent needs access to a payment processing API it can interface with. The agent will validate payment amounts against configured business rules. Payments can be scheduled for immediate processing or future dates based on your configuration.

#### Field Descriptions

| Field | Description | Data Type | Notes |
|-------|-------------|-----------|--------|
| `AccountID` | Customer account identifier | String | Must match existing account |
| `PaymentAmount` | Amount to be processed | Number | Validated against business rules |
| `PaymentDate` | Date when payment will be processed | String | Current or future date |
| `PaymentMethodID` | Unique identifier for payment method | String | From customer's available methods |
| `AccountNumberLastFour` | Last 4 digits of account number | String | For verification and display |
| `PaymentType` | Type of payment being made | String | e.g., "REGULAR", "PARTIAL", "FULL" |

#### Request Body

```json
{
  "AccountID": "string",
  "PaymentAmount": "number",
  "PaymentDate": "YYYY-MM-DD",
  "PaymentMethodID": "string",
  "AccountNumberLastFour": "string",
  "PaymentType": "string"
}
```

#### Payment Processing Rules

- **Minimum Payment**: Configurable minimum payment amount based on your business rules
- **Maximum Payment**: Optional maximum payment limit
- **Future Dating**: Configure how far in advance payments can be scheduled
- **Payment Validation**: Custom validation rules can be implemented

### 3. Post Call Webhook

This webhook is triggered after each collection call completes. It provides call outcome data and customer responses to help you update your systems and determine next actions.

#### Field Descriptions

| Field | Description | Data Type | Notes |
|-------|-------------|-----------|--------|
| `CallID` | Unique identifier for this call session | String | Used for call tracking and retrieval |
| `AccountID` | The account ID for this customer | String | From original trigger data |
| `CustomerName` | Full name of the customer contacted | String | Verified during call |
| `CallTimestamp` | When the call was completed | String | ISO 8601 format |
| `CallDurationSeconds` | Length of the call in seconds | Number | Total talk time |
| `CallOutcome` | Result of the call attempt | Enum | Connection status |
| `CustomerVerified` | Whether customer identity was confirmed | Boolean | Based on verification process |
| `PaymentCollected` | Whether payment was processed during call | Boolean | True if payment successful |
| `PaymentDetails` | Payment transaction information | Object | Only populated if payment collected |
| `PromiseToPay` | Payment commitment details | Object | Contains commitment status, amount, and date |
| `ReasonForDelinquency` | Why the customer hasn't paid | String/Null | If applicable and collected |
| `CallSummary` | AI-generated summary of the call | String | Key points and outcomes |
| `NextSteps` | Recommended follow-up actions | String | Based on call outcome |
| `ComplianceFlags` | Any compliance-related indicators | Object | DO_NOT_CALL, CEASE_DESIST, etc. |
| `CustomData` | Organization-specific data collected | Object | Customizable fields |

#### Webhook Payload

```json
{
  "CallID": "string",
  "AccountID": "string",
  "CustomerName": "string",
  "CallTimestamp": "YYYY-MM-DDTHH:MM:SSZ",
  "CallDurationSeconds": "number",
  "CallOutcome": "Connected|Voicemail|NoAnswer|Busy|Failed|DidNotDial",
  "CustomerVerified": "boolean",
  "PaymentCollected": "boolean",
  "PaymentDetails": {
    "PaymentAmount": "number",
    "PaymentDate": "YYYY-MM-DD",
    "PaymentMethodID": "string",
    "AccountNumberLastFour": "string",
    "TransactionID": "string"
  },
  "PromiseToPay": {
    "Collected": "boolean",
    "Amount": "number|null",
    "Date": "YYYY-MM-DD|null"
  },
  "ReasonForDelinquency": "string|null",
  "CallSummary": "string",
  "NextSteps": "string",
  "ComplianceFlags": {
    "DoNotCall": "boolean",
    "CeaseAndDesist": "boolean",
    "CustomerDeceased": "boolean",
    "PreferNotToBeContacted": "boolean"
  },
  "CustomData": {}
}
```

## Integration Options

### Real-time Integration
- Direct API integration with your CRM or collections platform
- Webhook-based updates for call outcomes
- Real-time payment processing

### Batch Processing
- Bulk entity upload via API or file transfer
- Scheduled campaign execution
- Batch result reporting

### Custom Workflows
- Configure call scripts and decision trees
- Custom verification questions
- Organization-specific payment rules
- Multi-language support

## Configuration Options

Your collections agent can be customized with:

- **Call Scripts**: Tailored messaging for your brand and compliance requirements
- **Verification Process**: Custom identity verification questions
- **Payment Rules**: Minimum/maximum amounts, payment plans, future dating limits
- **Compliance Settings**: State-specific regulations, time zones, call frequency limits
- **Language Support**: Multiple language options for diverse customer bases
- **Integration Points**: Custom API endpoints, webhook configurations, data mappings

## Testing and Validation

### Test Environment
- Sandbox environment with test phone numbers
- Simulated payment processing
- Test webhook endpoints
- Sample data sets for validation

### Testing Checklist
1. Validate data field mappings
2. Test authentication and authorization
3. Verify webhook delivery and processing
4. Confirm payment processing flow
5. Test error handling and edge cases
6. Validate compliance rules

## Support and Implementation

For questions, implementation assistance, or to begin your integration:

- **Technical Documentation**: Full API documentation available upon request
- **Implementation Support**: Dedicated implementation team for onboarding
- **Testing Resources**: Access to sandbox environment and test data
- **Production Setup**: Configuration of your production campaign and endpoints
- **Ongoing Support**: Technical support and monitoring dashboards
