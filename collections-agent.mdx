# Kastle AI - Payment Collections Agent API Documentation

## Overview

This documentation outlines the API integration for Kastle AI's payment collections agent. The system processes borrower entities and makes automated outbound calls based on the data you provide. This API can be customized for your organization's specific collections workflow and requirements.

There are two types of APIs that will be made available:
- **Test API Endpoints**: For testing and development with a pre-configured campaign
- **Production Entity Management APIs**: For production campaigns with your own campaign IDs

## Data Requirements

The following is a comprehensive list of data fields that can be configured for your payment collections agent. Fields can be customized based on your organization's requirements:

### Core Customer Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| FirstName               | Customer first name                                                               | String    |
| LastName                | Customer last name                                                                | String    |
| DOB                     | Customer's date of birth, in YYYY-MM-DD format                                     | String    |
| TaxIDLastFour           | Last four digits of customer's social security number                             | Number    |
| AccountID               | The unique identifier for the customer's account, used for lookup and verification | String    |
| PhoneNumber             | Customer's phone number                                                           | String    |
| Email                   | Customer's email address                                                          | String    |
| PreferredLanguage       | Code indicating the customer's preferred language (e.g., en=English, es=Spanish)  | String    |

### Address Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| PrimaryAddress          | Customer's primary address - street address                                       | String    |
| PrimaryCity             | Customer's primary address - city                                                 | String    |
| PrimaryState            | Customer's primary address - state                                                | String    |
| PrimaryZip              | Customer's primary address - ZIP code                                             | String    |
| MailingAddress          | Customer's mailing address - street address                                       | String    |
| MailingCity             | Customer's mailing address - city                                                 | String    |
| MailingState            | Customer's mailing address - state                                                | String    |
| MailingZip              | Customer's mailing address - ZIP code                                             | String    |

### Account Financial Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| RegularPaymentAmount    | The regular payment amount due                                                    | Number    |
| TotalAmountDue          | The total amount currently due including all charges and fees                     | Number    |
| LateChargesBalance      | The amount of any late fees currently assessed on the account                     | Number    |
| AccountBalance          | The current total balance of the account                                          | Number    |
| PendingPayment          | Boolean indicator of whether there's a payment currently being processed          | Boolean   |
| HasAutomaticPayments    | Boolean indicator of whether the customer is enrolled in automatic payments       | Boolean   |
| DaysLate                | The number of days the account is past due, if applicable                         | Number    |
| NextPaymentDueDate      | The date when the customer's next payment is due, in YYYY-MM-DD format            | String    |
| LastPaymentDate         | The date when the most recent payment was received, in YYYY-MM-DD format          | String    |
| LastPaymentAmount       | The amount of the last payment received                                           | Number    |

### Payment Methods

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| PaymentMethods          | An array of available payment methods with AccountId and AccountNumberLastFour    | Array[JSON] |

### Account Status Information

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| AccountStatus           | The current status of the account (e.g., CURRENT, DELINQUENT, COLLECTIONS)        | String    |
| LastContactDate         | The date when the customer was last contacted                                     | String    |
| CustomerFlags           | Any special handling flags (e.g., DO_NOT_CALL, DECEASED, VIP)                    | Array[String] |
| PaymentHistory          | An array of recent transaction activity                                           | Array[JSON] |

#### Payment History Object Structure

Each payment history object in the `PaymentHistory` array contains:

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| PaidDate                 | Date when the payment was made, in YYYY-MM-DD format                              | String    |
| PaymentAmount            | Amount of the payment                                                             | Number    |
| TransactionDescription   | Description of the transaction type (e.g., "ACH", "Check", "Wire", "Correction") | String    |

### Additional Customer Information (Optional)

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| Coborrowers             | Array of co-borrower information (supports 'n' number of co-borrowers)            | Array[JSON] |
| CustomField1            | Organization-specific custom field                                                | String    |
| CustomField2            | Organization-specific custom field                                                | String    |
| CustomField3            | Organization-specific custom field                                                | String    |

#### Coborrower Object Structure

Each coborrower object in the `Coborrowers` array contains:

| Field                   | Field Description                                                                 | Data Type |
|--------------------------|-----------------------------------------------------------------------------------|-----------|
| Name                    | Full name of the co-borrower                                                      | String    |
| PhoneNumber             | Phone number of the co-borrower                                                   | String    |
| DOB                     | Date of birth of the co-borrower, in YYYY-MM-DD format                            | String    |
| Email                   | Email address of the co-borrower (optional)                                       | String    |
| PreferredLanguage       | Code indicating the co-borrower's preferred language (e.g., en=English, es=Spanish) (optional) | String    |

### Example Data

See below for an example JSON schema of the datapoints above, with example data.

```json
{
  "FirstName": "John",
  "LastName": "Smith",
  "DOB": "1973-06-15",
  "TaxIDLastFour": 6394,
  "AccountID": "ACC-1234567",
  "PhoneNumber": "+19876543210",
  "Email": "john.smith@example.com",
  "PreferredLanguage": "en",
  "PrimaryAddress": "123 Main Street",
  "PrimaryCity": "San Francisco",
  "PrimaryState": "California",
  "PrimaryZip": "94103",
  "MailingAddress": "123 Main Street",
  "MailingCity": "San Francisco",
  "MailingState": "California",
  "MailingZip": "94103",
  "RegularPaymentAmount": 1250,
  "TotalAmountDue": 1500,
  "LateChargesBalance": 250,
  "AccountBalance": 45000,
  "PendingPayment": false,
  "HasAutomaticPayments": false,
  "DaysLate": 10,
  "NextPaymentDueDate": "2025-09-28",
  "LastPaymentDate": "2025-08-28",
  "LastPaymentAmount": 1250,
  "PaymentMethods": [
    {
      "AccountId": "57bfcd39-cf7a-42e9-8934-ccfd95669868",
      "AccountNumberLastFour": "1234"
    },
    {
      "AccountId": "b8d0cb94-a46c-4ddf-9b31-e21415a7b3ba",
      "AccountNumberLastFour": "5678"
    }
  ],
  "AccountStatus": "DELINQUENT",
  "LastContactDate": "2025-08-15",
  "CustomerFlags": [],
  "PaymentHistory": [
    {
      "PaidDate": "2025-08-28",
      "PaymentAmount": 1250.00,
      "TransactionDescription": "ACH"
    },
    {
      "PaidDate": "2025-07-28",
      "PaymentAmount": 1245.12,
      "TransactionDescription": "ACH"
    },
    {
      "PaidDate": "2025-06-29",
      "PaymentAmount": 1275.89,
      "TransactionDescription": "ACH"
    }
  ],
  "Coborrowers": [
    {
      "Name": "Jane Smith",
      "PhoneNumber": "+19876543211",
      "DOB": "1975-06-16",
      "Email": "jane.smith@example.com",
      "PreferredLanguage": "en"
    },
    {
      "Name": "Robert Smith",
      "PhoneNumber": "+19876543212",
      "DOB": "1977-03-20",
      "Email": "robert.smith@example.com",
      "PreferredLanguage": "en"
    }
  ]
}
```

## API Endpoints

Test and production API endpoints will be configured based on your organization's requirements and infrastructure.

### 1. Trigger Call Endpoint

**Endpoint:** `/collections/{organization}/{environment}/trigger-call`  
**Method:** POST  
**Content-Type:** application/json  
**Authentication:** Bearer token or API key required

Note: This endpoint triggers an automated collection call to the specified customer. Authentication is required with valid organization credentials. The environment may be `test`, `staging`, or `prod`.

#### Request Body

The request body should include the customer data fields configured for your organization. See the Data Requirements section above for available fields.

**Optional Configuration Fields:**

| Field | Description | Data Type | Default |
|-------|-------------|-----------|---------|
| `MaxPaymentLimit` | Maximum payment amount allowed for this entity. If not set, defaults to $10,000 configured on the agent. | Number | 10000 |
| `MaxDate` | Maximum date allowed for payment scheduling (YYYY-MM-DD format). If not set, defaults to today's date configured on the agent. | String | Today |

```json
{
  "FirstName": "string",
  "LastName": "string",
  "AccountID": "string",
  "PhoneNumber": "string",
  "MaxPaymentLimit": 10000,
  "MaxDate": "2025-12-31",
  // ... additional fields based on your configuration
}
```

**Note:** If `MaxPaymentLimit` or `MaxDate` are not provided in the request, default values will be configured on the agent (today's date for `MaxDate`, up to $10,000 for `MaxPaymentLimit`).

#### Response

**Success Response (200 OK):**
```json
{
  "message": "Campaign entity created successfully",
  "entity_id": "string",
  "call_scheduled_for": "YYYY-MM-DDTHH:MM:SSZ",
  "data": {
    // Returns the submitted data with generated entity_id
  }
}
```

**Error Response (400 Bad Request):**
```json
{
  "status": "error",
  "error": "Invalid request data",
  "details": "string"
}
```

**Error Response (401 Unauthorized):**
```json
{
  "status": "error",
  "error": "Invalid or missing authentication token"
}
```

### 2. Process Payment API

During a collection call, the agent needs access to a payment processing API it can interface with. The agent will validate payment amounts against configured business rules. Payments can be scheduled for immediate processing or future dates based on your configuration.

#### Field Descriptions

##### Required Fields

| Field | Description | Data Type | Notes |
|-------|-------------|-----------|--------|
| `AccountID` | Customer account identifier | String | Must match existing account |
| `PaymentAmount` | Total amount to be processed | Number | Validated against business rules |
| `PaymentDate` | Date when payment will be processed | String | Current or future date (YYYY-MM-DD format) |

##### Optional Payment Breakdown Fields

| Field | Description | Data Type | Notes |
|-------|-------------|-----------|--------|
| `BasePayment` | Base payment amount (excluding principal and fees) | Number | Optional - provides granular payment breakdown |
| `Principal` | Principal amount included in payment | Number | Optional - additional principal payment beyond base |
| `LateFee` | Late fee amount included in payment | Number | Optional - late fee portion of payment |
| `ScheduledDate` | Scheduled date for payment processing | String | Optional - specific scheduled date (YYYY-MM-DD format) |

##### Payment Method Fields

| Field | Description | Data Type | Notes |
|-------|-------------|-----------|--------|
| `PaymentMethodType` | Type of payment method | String | Required if using new account. Values: "NEW" or "EXISTING" |
| `AccountType` | Type of bank account | String | Required for new accounts. Values: "CHECKING" or "SAVINGS" |
| `RoutingNumber` | Bank routing number | String | Required for new accounts (9 digits) |
| `AccountNumber` | Full bank account number | String | Required for new accounts |
| `PaymentMethodID` | Unique identifier for existing payment method | String | Required for existing accounts - from customer's available methods |
| `AccountNumberLastFour` | Last 4 digits of account number | String | Required for existing accounts - for verification and display |

##### Additional Optional Fields

| Field | Description | Data Type | Notes |
|-------|-------------|-----------|--------|
| `PaymentType` | Type of payment being made | String | Optional - e.g., "REGULAR", "PARTIAL", "FULL" |

#### Request Body Examples

**Example 1: Payment with existing account (minimal fields)**
```json
{
  "AccountID": "ACC-1234567",
  "PaymentAmount": 1250.00,
  "PaymentDate": "2025-10-15",
  "PaymentMethodType": "EXISTING",
  "PaymentMethodID": "57bfcd39-cf7a-42e9-8934-ccfd95669868",
  "AccountNumberLastFour": "1234"
}
```

**Example 2: Payment with new account and granular breakdown**
```json
{
  "AccountID": "ACC-1234567",
  "PaymentAmount": 1750.00,
  "PaymentDate": "2025-10-15",
  "BasePayment": 1250.00,
  "Principal": 200.00,
  "LateFee": 50.00,
  "ScheduledDate": "2025-10-15",
  "PaymentMethodType": "NEW",
  "AccountType": "CHECKING",
  "RoutingNumber": "123456789",
  "AccountNumber": "9876543210"
}
```

**Example 3: Payment with existing account and granular breakdown**
```json
{
  "AccountID": "ACC-1234567",
  "PaymentAmount": 1750.00,
  "PaymentDate": "2025-10-15",
  "BasePayment": 1250.00,
  "Principal": 200.00,
  "LateFee": 50.00,
  "ScheduledDate": "2025-10-15",
  "PaymentMethodType": "EXISTING",
  "PaymentMethodID": "57bfcd39-cf7a-42e9-8934-ccfd95669868",
  "AccountNumberLastFour": "1234",
  "PaymentType": "REGULAR"
}
```

**Example 4: Payment with new savings account**
```json
{
  "AccountID": "ACC-1234567",
  "PaymentAmount": 1250.00,
  "PaymentDate": "2025-10-15",
  "PaymentMethodType": "NEW",
  "AccountType": "SAVINGS",
  "RoutingNumber": "987654321",
  "AccountNumber": "1234567890"
}
```

#### Payment Processing Rules

- **Minimum Payment**: Configurable minimum payment amount based on your business rules
- **Maximum Payment**: Optional maximum payment limit
- **Future Dating**: Configure how far in advance payments can be scheduled
- **Payment Validation**: Custom validation rules can be implemented

#### Field Validation Rules

- **Payment Breakdown**: If `BasePayment`, `Principal`, or `LateFee` are provided, they should sum to `PaymentAmount` (with tolerance for rounding)
- **Payment Method Type**: 
  - If `PaymentMethodType` is "NEW": `AccountType`, `RoutingNumber`, and `AccountNumber` are required
  - If `PaymentMethodType` is "EXISTING": `PaymentMethodID` and `AccountNumberLastFour` are required
- **Routing Number**: Must be exactly 9 digits for new accounts
- **Account Number**: Required for new accounts, must be valid account number format
- **Account Type**: Must be either "CHECKING" or "SAVINGS" when `PaymentMethodType` is "NEW"
- **Scheduled Date**: If provided, must be a valid date in YYYY-MM-DD format and within allowed future dating window

### 3. Post Call Webhook

This webhook is triggered after each collection call completes. It provides call outcome data and customer responses to help you update your systems and determine next actions.

#### Field Descriptions

| Field | Description | Data Type | PII | Notes |
|-------|-------------|-----------|-----|--------|
| `KastleCallID` | Unique identifier for this call session | String | | Used for call tracking and retrieval. Will be "NA" if no call was made |
| `AccountID` | The account ID for this customer | String | | From original trigger data |
| `CustomerName` | Full name of the customer contacted | String | ⚠️ | Concatenation of FirstName and LastName from trigger data |
| `BorrowerType` | Type of borrower contacted | Enum | | Allowed values: `Primary`, `Secondary`, `NA` |
| `CallTimestamp` | When the call was completed | String | | ISO 8601 format (YYYY-MM-DDTHH:MM:SSZ). Will be "NA" if no call was made |
| `CallDurationSeconds` | Length of the call in seconds | Number | | Total talk time. Will be 0 if no call was made |
| `PastDueAmountInformed` | Whether the past due amount was communicated | Boolean | | True if amount was discussed |
| `OccupancyStatus` | Current property occupancy status | Enum | | Allowed values: `Occupied`, `Vacant`, `Tenant`, `Unknown` |
| `ReasonForDelinquency` | Why the customer is delinquent | String/Null | | Currently not implemented (set to null) |
| `PromiseToPay` | Payment commitment details | Object | | Contains Collected (boolean), Amount (number or "N/A"), and Date (YYYY-MM-DD or "N/A") |
| `KastleCallSummary` | AI-generated summary of the call | String | | Key points and outcomes. If call was suppressed or not made, contains reason |
| `QRPCIndicator` | Qualified Right Party Contact indicator | Boolean | | True if verified customer was reached |
| `CallOutcome` | Result of the call attempt | Enum | | Allowed values: `Connected`, `Voicemail`, `No Answer`, `Busy`, `Failed`, `Did Not Dial`, `Transferred`, `Warm Transferred`, `In Progress` |
| `RPC` | Whether the customer confirmed their name | Boolean | | Right Party Contact indicator |
| `BorrowerVerified` | Whether customer identity was confirmed | Boolean | | Based on DOB verification |
| `PaymentCollected` | Whether payment was processed during call | Boolean | | True if payment successful |
| `PaymentDetails` | Payment transaction information | Object/Null | ⚠️ | Only populated if payment collected. Contains PaymentAmount, PaymentDate, and AccountID |
| `BorrowerDeceased` | Indicates if borrower is reported as deceased | Boolean | | Compliance flag for account handling |
| `CeaseAndDesist` | Customer has requested to cease communication | Boolean | | Legal compliance indicator |
| `DoNotCall` | Customer is on do-not-call list | Boolean | | Regulatory compliance flag |
| `AttorneyCommunicationRequested` | Customer mentioned they are represented by an attorney | Boolean | | Used to change the person being contacted for account |
| `AttorneyDetails` | Details of the customer's attorney | Object/Null | | Contains Name, Phone, Email. Null if AttorneyCommunicationRequested is false |

#### Webhook Payload

```json
{
  "KastleCallID": "string",
  "AccountID": "string",
  "CustomerName": "string",
  "BorrowerType": "Primary|Secondary|NA",
  "CallTimestamp": "YYYY-MM-DDTHH:MM:SSZ",
  "CallDurationSeconds": "number",
  "PastDueAmountInformed": "boolean",
  "OccupancyStatus": "Occupied|Vacant|Tenant|Unknown",
  "ReasonForDelinquency": "string|null",
  "PromiseToPay": {
    "Collected": "boolean",
    "Amount": "number|string",
    "Date": "YYYY-MM-DD|string"
  },
  "KastleCallSummary": "string",
  "QRPCIndicator": "boolean",
  "CallOutcome": "Connected|Voicemail|NoAnswer|Busy|Failed|DidNotDial|Transferred|Warm Transferred|Warm Transfer Failed",
  "RPC": "boolean",
  "BorrowerVerified": "boolean",
  "PaymentCollected": "boolean",
  "PaymentDetails": {
    "PaymentAmount": "number",
    "PaymentDate": "YYYY-MM-DD",
    "BasePayment": "number|null",
    "Principal": "number|null",
    "LateFee": "number|null",
    "ScheduledDate": "YYYY-MM-DD|null",
    "PaymentMethodType": "NEW|EXISTING",
    "AccountType": "CHECKING|SAVINGS|null",
    "PaymentMethodID": "string|null",
    "AccountNumberLastFour": "string|null",
    "RoutingNumber": "string|null",
    "TransactionID": "string"
  },
  "BorrowerDeceased": "boolean",
  "CeaseAndDesist": "boolean",
  "DoNotCall": "boolean",
  "AttorneyCommunicationRequested": "boolean",
  "AttorneyDetails": {
    "Name": "string",
    "Phone": "string",
    "Email": "string"
  }
}
```

#### Example Request

```json
{
  "KastleCallID": "call_abc123xyz789",
  "AccountID": "ACC-2024-001234",
  "CustomerName": "John Smith",
  "BorrowerType": "Primary",
  "CallTimestamp": "2024-10-29T16:00:00Z",
  "CallDurationSeconds": 245,
  "PastDueAmountInformed": true,
  "OccupancyStatus": "Occupied",
  "ReasonForDelinquency": "Temporary loss of income due to medical leave",
  "PromiseToPay": {
    "Collected": true,
    "Amount": 2500.00,
    "Date": "2025-11-15"
  },
  "KastleCallSummary": "Reached primary customer. Confirmed property is occupied. Customer explained delinquency due to medical leave but expects to return to work soon. Committed to payment of $2,500 by November 15th to bring account current. Customer was cooperative and expressed intent to maintain account in good standing.",
  "QRPCIndicator": true,
  "CallOutcome": "Connected",
  "RPC": true,
  "BorrowerVerified": true,
  "PaymentCollected": false,
  "PaymentDetails": null,
  "BorrowerDeceased": false,
  "CeaseAndDesist": false,
  "DoNotCall": false,
  "AttorneyCommunicationRequested": true,
  "AttorneyDetails": {
    "Name": "Smith & Associates Law Firm",
    "Phone": "555-123-4567",
    "Email": "contact@smithlawfirm.com"
  }
}
```

## Integration Options

### Real-time Integration
- Direct API integration with your CRM or collections platform
- Webhook-based updates for call outcomes
- Real-time payment processing

### Batch Processing
- Bulk entity upload via API or file transfer
- Scheduled campaign execution
- Batch result reporting

### Custom Workflows
- Configure call scripts and decision trees
- Custom verification questions
- Organization-specific payment rules
- Multi-language support

## Configuration Options

Your collections agent can be customized with:

- **Call Scripts**: Tailored messaging for your brand and compliance requirements
- **Verification Process**: Custom identity verification questions
- **Payment Rules**: Minimum/maximum amounts, payment plans, future dating limits
- **Compliance Settings**: State-specific regulations, time zones, call frequency limits
- **Language Support**: Multiple language options for diverse customer bases
- **Integration Points**: Custom API endpoints, webhook configurations, data mappings

## Testing and Validation

### Test Environment
- Sandbox environment with test phone numbers
- Simulated payment processing
- Test webhook endpoints
- Sample data sets for validation

### Testing Checklist
1. Validate data field mappings
2. Test authentication and authorization
3. Verify webhook delivery and processing
4. Confirm payment processing flow
5. Test error handling and edge cases
6. Validate compliance rules

## Support and Implementation

For questions, implementation assistance, or to begin your integration:

- **Technical Documentation**: Full API documentation available upon request
- **Implementation Support**: Dedicated implementation team for onboarding
- **Testing Resources**: Access to sandbox environment and test data
- **Production Setup**: Configuration of your production campaign and endpoints
- **Ongoing Support**: Technical support and monitoring dashboards
